<!-- Современная страница поиска -->
<div class="modern-search-page">
  <!-- Заголовок страницы -->
  <section class="search-header" aria-labelledby="search-heading">
    <div class="container">
      <div class="header-content">
        <h1 id="search-heading" class="page-title">
          <i class="fas fa-search"></i>
          Поиск автомобилей
        </h1>
        <p class="page-subtitle">Найдите идеальный автомобиль по вашим критериям</p>
      </div>
    </div>
  </section>

  <div class="container">
    <div class="search-layout">
      <!-- Левая панель фильтров -->
      <div class="filters-panel">
        <div class="filters-card">
          <div class="filters-header">
            <h3 class="filters-title">
              <i class="fas fa-filter"></i>
              Фильтры поиска
            </h3>
            <button class="clear-filters-btn" (click)="clearAllFilters()">
              <i class="fas fa-times"></i>
              Очистить все
            </button>
          </div>

          @if (form && BRANDS_AND_MODELS) {
            <form [formGroup]="form" class="filters-form">
              <!-- Основные фильтры -->
              <div class="filter-section">
                <h4 class="filter-section-title">Основные параметры</h4>
                
                <div class="filter-group">
                  <label class="filter-label">
                    <i class="fas fa-car"></i>
                    Марка автомобиля
                  </label>
                  <ng-select
                    [items]="brands"
                    bindLabel="title"
                    bindValue="title"
                    placeholder="Выберите марку"
                    [searchable]="true"
                    formControlName="brand"
                    (clear)="clearControl('brand')"
                    class="modern-select">
                  </ng-select>
                </div>

                <div class="filter-group">
                  <label class="filter-label">
                    <i class="fas fa-tag"></i>
                    Модель
                  </label>
                  <ng-select
                    [items]="models"
                    bindLabel="title"
                    bindValue="title"
                    placeholder="Выберите модель"
                    [searchable]="true"
                    formControlName="model"
                    (clear)="clearControl('model')"
                    class="modern-select">
                  </ng-select>
                </div>

                <div class="price-range">
                  <label class="filter-label">
                    <i class="fas fa-ruble-sign"></i>
                    Ценовой диапазон
                  </label>
                  <div class="price-inputs">
                    <div class="price-input">
                      <input
                        type="number"
                        class="modern-input"
                        placeholder="От"
                        formControlName="priceStart"
                      />
                    </div>
                    <div class="price-separator">—</div>
                    <div class="price-input">
                      <input
                        type="number"
                        class="modern-input"
                        placeholder="До"
                        formControlName="priceEnd"
                      />
                    </div>
                  </div>
                </div>
              </div>

              <!-- Кнопка дополнительных фильтров для мобильных -->
              <div class="mobile-filters-toggle">
                <button 
                  type="button" 
                  class="toggle-btn"
                  (click)="toggleAdvancedFilters()">
                  <i class="fas" [class.fa-chevron-down]="!showAdvancedFilters" [class.fa-chevron-up]="showAdvancedFilters"></i>
                  {{ showAdvancedFilters ? 'Скрыть фильтры' : 'Дополнительные фильтры' }}
                </button>
              </div>

              <!-- Дополнительные фильтры -->
              <div class="advanced-filters" [class.expanded]="showAdvancedFilters">
                <h4 class="filter-section-title">Дополнительные параметры</h4>
                
                <div class="year-range">
                  <label class="filter-label">
                    <i class="fas fa-calendar"></i>
                    Год выпуска
                  </label>
                  <div class="year-inputs">
                    <div class="year-input">
                      <input
                        type="number"
                        class="modern-input"
                        placeholder="От"
                        formControlName="yearStart"
                      />
                    </div>
                    <div class="year-separator">—</div>
                    <div class="year-input">
                      <input
                        type="number"
                        class="modern-input"
                        placeholder="До"
                        formControlName="yearEnd"
                      />
                    </div>
                  </div>
                </div>

                <div class="filter-group">
                  <label class="filter-label">
                    <i class="fas fa-cogs"></i>
                    Коробка передач
                  </label>
                  <ng-select
                    [items]="gearboxes"
                    [multiple]="true"
                    [searchable]="true"
                    placeholder="Выберите коробку"
                    formControlName="gearbox"
                    class="modern-select">
                  </ng-select>
                </div>

                <div class="filter-group">
                  <label class="filter-label">
                    <i class="fas fa-gas-pump"></i>
                    Тип топлива
                  </label>
                  <ng-select
                    [items]="fuels"
                    [multiple]="true"
                    [searchable]="true"
                    placeholder="Выберите топливо"
                    formControlName="fuel"
                    class="modern-select">
                  </ng-select>
                </div>

                <div class="filter-group">
                  <label class="filter-label">
                    <i class="fas fa-car-side"></i>
                    Привод
                  </label>
                  <ng-select
                    [items]="drives"
                    [multiple]="true"
                    [searchable]="true"
                    placeholder="Выберите привод"
                    formControlName="drive"
                    class="modern-select">
                  </ng-select>
                </div>

                @for (group of options; track group) {
                  <div class="filter-group">
                    <label class="filter-label">
                      <i class="fas fa-list"></i>
                      {{ group.title }}
                    </label>
                    <ng-select
                      [items]="group.values"
                      [multiple]="true"
                      [searchable]="true"
                      placeholder="Выберите"
                      formControlName="{{ group.controlName }}"
                      class="modern-select">
                    </ng-select>
                  </div>
                }
              </div>

              <div class="search-actions">
                <button type="button" class="search-btn" (click)="search()">
                  <i class="fas fa-search"></i>
                  Найти автомобили
                </button>
              </div>
            </form>
          }
        </div>
      </div>

      <!-- Правая панель результатов -->
      <div class="results-panel">
        <!-- Информация о результатах -->
        @if (pagination) {
          <div class="results-header">
            <div class="results-info">
              <h2 class="results-title">
                <i class="fas fa-list"></i>
                Результаты поиска
              </h2>
              <div class="results-count">
                Найдено: <span class="count-number">{{ pagination.total }}</span> автомобилей
                <span class="page-info">(страница {{ pagination.page }} из {{ pagination.totalPages }})</span>
              </div>
            </div>
          </div>
        }

        <!-- Сетка автомобилей -->
        <section class="cars-grid" aria-labelledby="catalog-heading" itemscope itemtype="https://schema.org/CollectionPage">
          <h2 id="catalog-heading" class="sr-only">Каталог автомобилей из Европы</h2>
          @for (car of cars; track car?.id ?? $index) {
            <article class="car-card" itemscope itemtype="https://schema.org/Product">
              <app-car-item [car]="car"></app-car-item>
            </article>
          }
        </section>

        <!-- Пагинация -->
        @if (pagination && pagination.totalPages > 1) {
          <div class="pagination-wrapper">
            <nav class="modern-pagination">
              <button class="pagination-btn prev-btn" (click)="prevPage()" [disabled]="!pagination.hasPrev">
                <i class="fas fa-chevron-left"></i>
                Предыдущая
              </button>
              
              <div class="page-numbers">
                @for (pageNum of pageNumbers; track pageNum) {
                  <button 
                    class="page-number" 
                    [class.active]="pageNum === pagination.page"
                    (click)="goToPage(pageNum)">
                    {{ pageNum }}
                  </button>
                }
              </div>
              
              <button class="pagination-btn next-btn" (click)="nextPage()" [disabled]="!pagination.hasNext">
                Следующая
                <i class="fas fa-chevron-right"></i>
              </button>
            </nav>
          </div>
        }

        <!-- Сообщение если нет результатов -->
        @if (cars.length === 0 && pagination) {
          <div class="no-results">
            <div class="no-results-icon">
              <i class="fas fa-search"></i>
            </div>
            <h3 class="no-results-title">Автомобили не найдены</h3>
            <p class="no-results-text">Попробуйте изменить параметры поиска или очистить фильтры</p>
            <button class="clear-filters-btn" (click)="clearAllFilters()">
              <i class="fas fa-refresh"></i>
              Очистить фильтры
            </button>
          </div>
        }
      </div>
    </div>
  </div>
</div>
